<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ë¬´í•œ íŒŒë”±: CHIMERA</title>
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;700;900&family=Jua&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505; --panel: #121212;
            --n: #7f8c8d; --r: #3498db; --sr: #9b59b6; --ssr: #f1c40f; --ur: #00cec9; --f: #e74c3c;
            --text: #ecf0f1; --border: #333;
            --accent: #e67e22;
            --success: #2ecc71; /* ëˆ„ë½ëœ ìƒ‰ìƒ ì¶”ê°€: ì„ íƒ ë° ë ˆë²¨ì—…ìš© */
        }
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0; background: var(--bg); color: var(--text);
            font-family: 'Noto Sans KR', sans-serif;
            min-height: 100vh; overflow-y: auto; padding-bottom: 160px; /* í‘¸í„° ê³µê°„ í™•ë³´ */
        }
        
        h1, h2, .font-title { font-family: 'Black Han Sans', sans-serif; }
        .font-pixel { font-family: 'Jua', sans-serif; }

        /* HEADER */
        header {
            position: sticky; top: 0; z-index: 100;
            background: rgba(5, 5, 5, 0.95); border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center; padding: 10px 15px;
            backdrop-filter: blur(10px);
        }
        .cp-display { font-size: 1.2rem; color: var(--ssr); text-shadow: 0 0 10px rgba(241, 196, 15, 0.3); letter-spacing: 1px; }
        
        .reset-btn {
            background: #2d3436; color: #888; border: 1px solid #444; 
            padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; cursor: pointer;
        }

        /* FUSION ALTAR (ì‹ ê·œ ê¸°ëŠ¥: ìœµí•© ì œë‹¨) */
        .altar-area {
            margin: 15px; padding: 15px; background: linear-gradient(135deg, #181818, #000);
            border: 1px solid var(--sr); border-radius: 12px;
            display: flex; flex-direction: column; gap: 10px;
            box-shadow: 0 0 15px rgba(155, 89, 182, 0.2);
        }
        .altar-title { font-size: 1rem; color: var(--sr); display: flex; justify-content: space-between; align-items: center; }
        .altar-slots { display: flex; gap: 10px; justify-content: center; height: 60px; }
        .altar-slot { 
            width: 60px; height: 60px; border: 2px dashed #444; border-radius: 8px; 
            display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: #444;
            background: #111; transition: 0.2s;
        }
        .altar-slot.filled { border-style: solid; color: #fff; font-weight: bold; background: #222; }
        
        .btn-fuse {
            background: var(--sr); color: #fff; border: none; padding: 10px; border-radius: 8px;
            font-size: 1rem; font-weight: bold; cursor: pointer; width: 100%;
            box-shadow: 0 4px 0 #8e44ad; transition: 0.1s;
        }
        .btn-fuse:active { transform: translateY(4px); box-shadow: none; }
        .btn-fuse:disabled { filter: grayscale(1); opacity: 0.3; pointer-events: none; box-shadow: none; transform: translateY(2px); }

        /* CARD GRID (ê¸°ì¡´ ê¸°ëŠ¥: ì¹´ë“œ ëª©ë¡) */
        main { padding: 0 15px; display: flex; flex-direction: column; gap: 15px; }
        .slot-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        
        .card {
            background: var(--panel); border: 1px solid #333; border-radius: 8px; padding: 8px;
            position: relative; display: flex; flex-direction: column; gap: 4px; min-height: 100px;
            transition: 0.2s; cursor: pointer;
        }
        /* ì„ íƒëœ ì¹´ë“œ ìŠ¤íƒ€ì¼ ìˆ˜ì • (ì´ˆë¡ìƒ‰ í…Œë‘ë¦¬) */
        .card.selected { border: 2px solid var(--success); background: #0f2215; transform: scale(0.98); }
        
        /* Rank Styles */
        .card.UR { border: 2px solid var(--ur); background: radial-gradient(circle at top right, #004444, #000); box-shadow: 0 0 10px var(--ur); animation: glow 2s infinite alternate;}
        .card.SSR { border: 2px solid var(--ssr); background: radial-gradient(circle at top right, #3a2a05, #111); }
        .card.F { border: 2px solid var(--f); background: #220505; }
        
        .c-header { display: flex; justify-content: space-between; align-items: center; }
        .c-rank { font-size: 0.75rem; padding: 2px 5px; border-radius: 3px; color: #000; font-weight: bold; }
        .c-rank.UR { background: var(--ur); color: #000; box-shadow: 0 0 8px var(--ur); }
        .c-rank.SSR { background: var(--ssr); } 
        .c-rank.SR { background: var(--sr); color:#fff;}
        .c-rank.R { background: var(--r); color:#fff;} 
        .c-rank.N { background: var(--n); } 
        .c-rank.F { background: var(--f); color:#fff;}
        
        .c-lv { font-size: 0.7rem; color: #aaa; }
        .c-name { font-size: 0.95rem; font-weight: bold; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; color: #ddd;}
        .c-job { font-size: 0.7rem; color: #777; }
        
        @keyframes glow { from { box-shadow: 0 0 5px var(--ur); } to { box-shadow: 0 0 15px var(--ur); } }

        /* LOGS */
        #section-logs {
            background: #000; padding: 10px; border: 1px solid #333; border-radius: 8px;
            font-family: 'Noto Sans KR', monospace; font-size: 0.8rem; line-height: 1.5;
            height: 150px; overflow-y: auto;
        }
        .log { margin-bottom: 3px; border-bottom: 1px dashed #222; padding-bottom: 2px; }
        .l-sys { color: #555; } .l-ur { color: var(--ur); font-weight: bold; }
        .l-ssr { color: var(--ssr); } .l-fail { color: var(--f); } .l-up { color: var(--success); }

        /* FOOTER */
        footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            display: grid; grid-template-columns: 1fr 1.2fr; gap: 10px;
            padding: 15px; background: rgba(10,10,10,0.95); border-top: 1px solid #333; z-index: 90;
        }
        .btn-gacha {
            height: 60px; border: none; border-radius: 10px; color: #fff; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 4px 0 rgba(0,0,0,0.5); transition: 0.1s;
        }
        .btn-gacha:active { transform: translateY(4px); box-shadow: none; }
        .btn-gacha:disabled { filter: grayscale(1); opacity: 0.5; }
        
        #btn-norm { background: #34495e; border: 1px solid #555; }
        #btn-prem { background: linear-gradient(135deg, #00cec9, #0984e3); border: 1px solid #00cec9; }

        /* OVERLAYS */
        .overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000;
            display: none; justify-content: center; align-items: center; flex-direction: column;
        }
        .overlay.active { display: flex; animation: fadeIn 0.1s forwards; }
        .pop-card {
            background: #222; border-radius: 20px; padding: 30px; text-align: center; border: 4px solid #fff;
            min-width: 280px; box-shadow: 0 0 50px rgba(255,255,255,0.2); animation: popIn 0.3s forwards;
        }
        .pop-rank { font-size: 4rem; font-family: 'Black Han Sans'; margin-bottom: 5px; }
        
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <header>
        <div class="font-title cp-display">ğŸ’ <span id="ui-cp">0</span> CP</div>
        <button class="reset-btn" onclick="game.hardReset()">ì´ˆê¸°í™”</button>
    </header>

    <div class="altar-area">
        <div class="altar-title font-pixel">
            <span>ğŸ”® ì˜í˜¼ ìœµí•© (ê³ ë‹‰ ì„¸íƒê¸°)</span>
            <span style="font-size:0.7rem; color:#888;">2ëª… ì„ íƒí•˜ì—¬ í•©ì²´</span>
        </div>
        <div class="altar-slots">
            <div id="slot-1" class="altar-slot">ì„ íƒ1</div>
            <div style="display:flex; align-items:center; color:#555;">+</div>
            <div id="slot-2" class="altar-slot">ì„ íƒ2</div>
        </div>
        <button id="btn-fuse" class="btn-fuse font-pixel" onclick="game.fuse()" disabled>
            ìœµí•© ì‹œì‘ (ë¹„ìš©: 300 CP)
        </button>
    </div>

    <main>
        <div style="display:flex; justify-content:space-between; color:#888; font-size:0.8rem; margin-bottom:5px;">
            <span>ë³´ìœ  íŒŒë”± (<span id="ui-count">0</span>/12)</span>
            <span>ì¹´ë“œë¥¼ ëˆŒëŸ¬ ì„ íƒ/í•´ì œ</span>
        </div>
        <div id="slot-grid" class="slot-grid"></div>
        
        <div style="margin-top:10px;">
            <div style="color:#666; font-size:0.8rem; margin-bottom:5px;">ì‹œìŠ¤í…œ ë¡œê·¸</div>
            <div id="section-logs"></div>
        </div>
    </main>

    <footer>
        <button id="btn-norm" class="btn-gacha" onclick="game.pull('normal')">
            <span class="font-pixel" style="font-size:1.1rem;">ì¼ë°˜ ë½‘ê¸°</span>
            <span style="font-size:0.8rem; opacity:0.8;" id="cost-norm">100 CP</span>
        </button>
        <button id="btn-prem" class="btn-gacha" onclick="game.pull('premium')">
            <span class="font-pixel" style="font-size:1.1rem;">âœ¨ ê³ ê¸‰ ì¸ë ¥ì†Œ</span>
            <span style="font-size:0.8rem; opacity:0.8;" id="cost-prem">1000 CP</span>
        </button>
    </footer>

    <div id="overlay" class="overlay">
        <div id="pop-card" class="pop-card">
            <div id="pop-rank" class="pop-rank">SSR</div>
            <div id="pop-name" style="font-size:1.5rem; color:#fff; margin-bottom:5px;">ì´ë¦„</div>
            <div id="pop-desc" style="color:#aaa; font-size:0.9rem;">ë‚´ìš©</div>
        </div>
    </div>

<script>
const DB = {
    jobs: {
        N: ['ìœ ë™', 'ëˆˆíŒ…', 'ì§ˆë¬¸ì¶©', 'í•‘í”„', 'ë³µë¶™ëŸ¬'],
        R: ['ì •ë³´ê²Œì´', 'ì§¤ìŸì´', 'ë²ˆì—­ê°€', 'ë¦¬ë·°ì–´'],
        SR: ['24ì‹œê°„ìƒì£¼', 'ì½”ë“œìŠ¬ë ˆì´ì–´', 'ë¶€ê²€ì „ë¬¸ê°€', 'í‚¤ë°°ì™•'],
        SSR: ['ì„œë²„ê´€ë¦¬ì', 'ë¹›ì˜ì™„ì¥', 'AIì•Œë°”', 'ë””ì‹œí˜„ì'],
        UR: ['ê°¤ëŸ¬ë¦¬ì£¼ì¸', 'ì´ˆì›”ì', 'ìš´ì˜ì', 'ê¹€ìœ ì‹'],
        F: ['ë¶„íƒ•', 'ì¢†ëª©ì§ˆ', 'ë„¤ì„ë“œí˜¸ì†Œì¸', 'ì—¬ì™•ë²Œ', 'ë„ë°°ê¸°']
    },
    ranks: ['N', 'R', 'SR', 'SSR', 'UR', 'F'],
    power: { N:2, R:5, SR:15, SSR:40, UR:100, F:-10 }
};

const SAVE_KEY = "pasdak_v23_chimera"; // ì„¸ì´ë¸Œ í‚¤ ë²„ì „ ë³€ê²½ (ì¶©ëŒ ë°©ì§€)

class Game {
    constructor() {
        this.cp = 1000;
        this.pasdaks = [];
        this.maxSlots = 12; // ê³ ì • ìŠ¬ë¡¯
        this.selected = []; // ìœµí•©ìš© ì„ íƒ ID ë°°ì—´
        this.costNorm = 100;
        this.costPrem = 1000;
        
        this.ui = {
            cp: document.getElementById('ui-cp'),
            grid: document.getElementById('slot-grid'),
            logs: document.getElementById('section-logs'),
            overlay: document.getElementById('overlay'),
            popCard: document.getElementById('pop-card'),
            popRank: document.getElementById('pop-rank'),
            popName: document.getElementById('pop-name'),
            popDesc: document.getElementById('pop-desc'),
            slot1: document.getElementById('slot-1'),
            slot2: document.getElementById('slot-2'),
            btnFuse: document.getElementById('btn-fuse'),
            btnNorm: document.getElementById('btn-norm'),
            btnPrem: document.getElementById('btn-prem')
        };

        if(localStorage.getItem(SAVE_KEY)) this.loadGame();
        this.render();
        // 1ì´ˆë§ˆë‹¤ ìë™ ì‹¤í–‰ (ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€)
        setInterval(() => this.tick(), 1000);
    }

    /* --- GACHA (ë½‘ê¸° ê¸°ëŠ¥) --- */
    pull(type) {
        let cost = type === 'premium' ? this.costPrem : this.costNorm;
        if(this.cp < cost || this.pasdaks.length >= this.maxSlots) {
            if(this.pasdaks.length >= this.maxSlots) alert("ìŠ¬ë¡¯ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤! ìœµí•©í•˜ê±°ë‚˜ í•´ê³ í•˜ì„¸ìš”.");
            return;
        }

        this.cp -= cost;
        // ë¹„ìš© ì¦ê°€ (ì¸í”Œë ˆì´ì…˜)
        if(type==='premium') this.costPrem = Math.floor(this.costPrem * 1.1);
        else this.costNorm = Math.floor(this.costNorm * 1.1);

        const r = Math.random() * 100;
        let rank = 'N';

        if(type === 'premium') {
            // ê³ ê¸‰: UR 5%, SSR 20%, SR 40%, R 30%, F 5%
            if(r < 5) rank = 'UR';
            else if(r < 25) rank = 'SSR';
            else if(r < 65) rank = 'SR';
            else if(r < 95) rank = 'R';
            else rank = 'F'; 
        } else {
            // ì¼ë°˜: SSR 2%, F 30%, SR 10%, R 20%, N 38%
            if(r < 2) rank = 'SSR';
            else if(r < 32) rank = 'F';
            else if(r < 42) rank = 'SR';
            else if(r < 62) rank = 'R';
            else rank = 'N';
        }

        this.addPasdak(rank, type === 'premium');
        this.saveGame();
    }

    addPasdak(rank, isPrem) {
        const jobList = DB.jobs[rank];
        const job = jobList[Math.floor(Math.random() * jobList.length)];
        const name = (Math.random()<0.5?'ìœ ë™':'ê³ ë‹‰') + Math.floor(Math.random()*999);
        
        const p = {
            id: Math.random().toString(36).substr(2, 9),
            rank, name, job,
            lv: 1, exp: 0,
            power: DB.power[rank],
            revealed: false, // ìˆ˜ìŠµ ê¸°ê°„ (ë¹„ê³µê°œ ìƒíƒœ)
            revealTimer: isPrem ? 3 : 8 // ê³ ê¸‰ì€ ë¹¨ë¦¬ ê¹Œì§
        };
        
        this.pasdaks.push(p);
        this.showPop(p, true); // Hidden popup
        this.render();
    }

    /* --- FUSION (ìœµí•© ê¸°ëŠ¥: ì‹ ê·œ) --- */
    toggleSelect(id) {
        const idx = this.selected.indexOf(id);
        if(idx > -1) {
            this.selected.splice(idx, 1); // ì„ íƒ í•´ì œ
        } else {
            if(this.selected.length >= 2) this.selected.shift(); // 2ê°œ ì´ˆê³¼ì‹œ ì˜¤ë˜ëœ ê²ƒ ì œê±°
            this.selected.push(id);
        }
        this.render(); // ì„ íƒ ìƒíƒœ UI ë°˜ì˜
        this.updateAltar(); // ì œë‹¨ ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸
    }

    updateAltar() {
        const p1 = this.pasdaks.find(p => p.id === this.selected[0]);
        const p2 = this.pasdaks.find(p => p.id === this.selected[1]);

        // ìŠ¬ë¡¯ 1 UI
        this.ui.slot1.className = p1 ? `altar-slot filled` : `altar-slot`;
        this.ui.slot1.innerText = p1 ? `[${p1.revealed?p1.rank:'?'}]` : "ì„ íƒ1";
        this.ui.slot1.style.borderColor = p1 && p1.revealed ? this.getRankColor(p1.rank) : '#444';

        // ìŠ¬ë¡¯ 2 UI
        this.ui.slot2.className = p2 ? `altar-slot filled` : `altar-slot`;
        this.ui.slot2.innerText = p2 ? `[${p2.revealed?p2.rank:'?'}]` : "ì„ íƒ2";
        this.ui.slot2.style.borderColor = p2 && p2.revealed ? this.getRankColor(p2.rank) : '#444';

        // ìœµí•© ë²„íŠ¼ í™œì„±í™” ì¡°ê±´
        this.ui.btnFuse.disabled = this.selected.length !== 2 || this.cp < 300;
    }

    fuse() {
        if(this.selected.length !== 2 || this.cp < 300) return;
        this.cp -= 300;

        const p1 = this.pasdaks.find(p => p.id === this.selected[0]);
        const p2 = this.pasdaks.find(p => p.id === this.selected[1]);
        
        // ê¸°ì¡´ ì¬ë£Œ ì‚­ì œ
        this.pasdaks = this.pasdaks.filter(p => !this.selected.includes(p.id));
        this.selected = [];

        // ìœµí•© ë¡œì§
        // ì ìˆ˜í™”: N=1, R=2, SR=3, SSR=4, UR=5, F=0
        const scoreMap = {N:1, R:2, SR:3, SSR:4, UR:5, F:0};
        const s1 = scoreMap[p1.revealed ? p1.rank : 'N']; 
        const s2 = scoreMap[p2.revealed ? p2.rank : 'N'];
        const avg = (s1 + s2) / 2;
        
        const r = Math.random();
        let newRank = 'N';
        
        if (r < 0.15) newRank = 'F'; // 15% í™•ë¥ ë¡œ ìœµí•© ëŒ€ì‹¤íŒ¨
        else if (r < 0.25 && avg >= 4) newRank = 'UR'; // SSRê¸‰ ì´ìƒ ìœµí•© ì‹œ ëŒ€ì„±ê³µ í™•ë¥ 
        else if (avg >= 3.5) newRank = 'SSR';
        else if (avg >= 2.5) newRank = 'SR';
        else if (avg >= 1.5) newRank = 'R';
        else newRank = 'N';

        // ê²°ê³¼ë¬¼ ìƒì„±
        const jobList = DB.jobs[newRank];
        const newP = {
            id: Math.random().toString(36).substr(2,9),
            rank: newRank,
            name: "í‚¤ë©”ë¼" + Math.floor(Math.random()*99),
            job: jobList[Math.floor(Math.random()*jobList.length)],
            lv: 1, exp: 0,
            power: DB.power[newRank],
            revealed: true, // ìœµí•©ì²´ëŠ” ë°”ë¡œ ê³µê°œ
            revealTimer: 0
        };
        this.pasdaks.push(newP);
        
        const logType = newRank === 'UR' ? 'l-ur' : (newRank === 'F' ? 'l-fail' : 'l-sys');
        this.log(`ğŸ§¬ [ìœµí•©] ${p1.name} + ${p2.name} â†’ [${newRank}] ${newP.name} íƒ„ìƒ!`, logType);
        
        if(newRank === 'UR') this.showPop(newP, false); // UR ëœ¨ë©´ íŒì—…
        
        this.render();
        this.updateAltar();
        this.saveGame();
    }

    /* --- TICK LOOP (ê¸°ì¡´: ìë™ ì‚¬ëƒ¥/ì±„êµ´) --- */
    tick() {
        let gain = 0;
        this.pasdaks.forEach(p => {
            // ì •ì²´ ê³µê°œ ë¡œì§
            if (!p.revealed) {
                p.revealTimer--;
                if (p.revealTimer <= 0) {
                    p.revealed = true;
                    // ë‹¤ì‹œ ë Œë”ë§ì„ ìœ„í•´ í”Œë˜ê·¸ í•„ìš”í•˜ë‚˜, ì•„ë˜ render()ì—ì„œ ì²˜ë¦¬ë¨
                    this.log(`ğŸ” [ì •ì²´] ${p.name} = [${p.rank}] í™•ì •!`, p.rank=='F'?'l-fail':'l-sys');
                }
            }

            // CP ìƒì‚° ë° ë ˆë²¨ì—… ë¡œì§
            let production = p.power + (p.lv * (p.rank=='UR'?5:1)); // URì€ ì„±ì¥í­ í¼
            if(p.rank === 'F') production = -5; // ë¶„íƒ•ì€ CPë¥¼ ê¹Œë¨¹ìŒ
            
            gain += production;
            
            // ê²½í—˜ì¹˜ íšë“
            p.exp++;
            if (p.exp >= p.lv * 20) { 
                p.lv++;
                p.exp = 0;
                if(Math.random() < 0.2) this.log(`ğŸ†™ [ì„±ì¥] ${p.name} Lv.${p.lv} ë‹¬ì„±!`, 'l-up');
            }
        });

        if(gain !== 0) this.cp += gain;
        this.render(); // í™”ë©´ ê°±ì‹ 
        this.saveGame();
    }

    /* --- RENDER & UI --- */
    render() {
        this.ui.cp.innerText = Math.floor(this.cp);
        document.getElementById('ui-count').innerText = this.pasdaks.length;
        
        // ë²„íŠ¼ ìƒíƒœ
        document.getElementById('cost-norm').innerText = this.costNorm + " CP";
        document.getElementById('cost-prem').innerText = this.costPrem + " CP";
        this.ui.btnNorm.disabled = this.cp < this.costNorm || this.pasdaks.length >= this.maxSlots;
        this.ui.btnPrem.disabled = this.cp < this.costPrem || this.pasdaks.length >= this.maxSlots;
        
        // ì¹´ë“œ ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
        this.ui.grid.innerHTML = '';
        this.pasdaks.forEach(p => {
            const el = document.createElement('div');
            const isSel = this.selected.includes(p.id);
            const rClass = p.revealed ? p.rank : 'Hidden';
            
            // ì„ íƒëœ ì¹´ë“œëŠ” .selected í´ë˜ìŠ¤ ì¶”ê°€
            el.className = `card ${rClass} ${isSel ? 'selected' : ''}`;
            el.onclick = () => this.toggleSelect(p.id);
            
            el.innerHTML = `
                <div class="c-header">
                    <span class="c-rank ${rClass}">${p.revealed ? p.rank : '???'}</span>
                    <span class="c-lv">Lv.${p.lv}</span>
                </div>
                <div class="c-name">${p.name}</div>
                <div class="c-job">${p.revealed ? p.job : 'ì‹¬ì‚¬ ì¤‘...'}</div>
                <div class="c-status" style="font-size:0.7rem; margin-top:auto;">
                    ${p.revealed ? `ì „íˆ¬ë ¥ ${p.power + (p.lv*(p.rank=='UR'?5:1))}` : '???'}
                </div>
            `;
            this.ui.grid.appendChild(el);
        });
    }

    log(msg, cls) {
        const d = document.createElement('div');
        d.className = `log ${cls||''}`; d.innerText = msg;
        this.ui.logs.appendChild(d);
        this.ui.logs.scrollTop = this.ui.logs.scrollHeight;
    }

    showPop(p, hidden=false) {
        const colors = {UR:'#00cec9', SSR:'#f1c40f', SR:'#9b59b6', R:'#3498db', N:'#7f8c8d', F:'#e74c3c'};
        
        if (hidden) {
            this.ui.popRank.innerText = "???";
            this.ui.popRank.style.color = "#fff";
            this.ui.popName.innerText = p.name;
            this.ui.popDesc.innerText = "ìˆ˜ìŠµ ì™„ì¥ (ì •ì²´ ë¶ˆëª…)";
            this.ui.popCard.style.borderColor = "#fff";
        } else {
            this.ui.popRank.innerText = p.rank;
            this.ui.popRank.style.color = colors[p.rank];
            this.ui.popName.innerText = p.name;
            this.ui.popDesc.innerText = `[${p.job}] íƒ„ìƒ!`;
            this.ui.popCard.style.borderColor = colors[p.rank];
        }
        
        const ol = this.ui.overlay;
        ol.classList.remove('active'); void ol.offsetWidth; ol.classList.add('active');
        setTimeout(()=>ol.classList.remove('active'), 1200);
    }

    getRankColor(r) {
        const map = {UR:'#00cec9', SSR:'#f1c40f', SR:'#9b59b6', R:'#3498db', N:'#7f8c8d', F:'#e74c3c'};
        return map[r] || '#fff';
    }

    saveGame() {
        const data = { cp: this.cp, pasdaks: this.pasdaks, costNorm: this.costNorm, costPrem: this.costPrem };
        localStorage.setItem(SAVE_KEY, JSON.stringify(data));
    }

    loadGame() {
        try {
            const d = JSON.parse(localStorage.getItem(SAVE_KEY));
            if(d) {
                this.cp = d.cp; this.pasdaks = d.pasdaks;
                this.costNorm = d.costNorm; this.costPrem = d.costPrem;
            }
        } catch(e) { console.log("Save error"); }
    }

    hardReset() {
        if(confirm("ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { localStorage.removeItem(SAVE_KEY); location.reload(); }
    }
}

window.game = new Game();
</script>
</body>
</html>
